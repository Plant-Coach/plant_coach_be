<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Ruby Critic - Home</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- StyleSheets -->
    <link href="../../../../assets/vendor/stylesheets/bootstrap.min.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../../../assets/vendor/stylesheets/font-awesome.min.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../../../assets/vendor/stylesheets/prettify.custom_theme.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../../../assets/stylesheets/application.css" media="screen, projection, print" rel="stylesheet" type="text/css">
  </head>

  <body>
    <header class="navbar navbar-default navbar-fixed-top">
      <a href="#menu-toggle" class="btn btn-default hidden-lg visible-sm-* hidden-md visible-xs-* pull-left" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a>
      <a href="../../../../overview.html"><img src="../../../../assets/images/logo.png" alt="Ruby Critic Logo" title="Ruby Critic Logo" width="55"><span class="logo">RUBYCRITIC</span></a>
      
        <ul class="nav navbar-nav navbar-right">
          <a href="../../../../../main/spec/requests/api/v1/garden_plants_request_spec.html"><span class="branch">main</span></a>
          <a href="../../../../overview.html"><span class="branch">add-rubycritic</span></a>
          <a href="../../../../../overview.html"><span class="branch">Build</span></a>
        </ul>
      
    </header>
    <div id="wrapper">
      <!-- Sidebar -->
      <aside id="sidebar-wrapper">
        <ul class="sidebar-nav">
          <li class="sidebar-item">
            <a href="../../../../overview.html" class="project-nav-item overview-nav"><i class="fa fa-dashboard"></i>Overview</a>
          </li>
          <li class="sidebar-item">
            <a href="../../../../code_index.html" class="project-nav-item code-index-nav"><i class="fa fa-code"></i>Code</a>
          </li>
          <li class="sidebar-item">
            <a href="../../../../smells_index.html" class="project-nav-item smells-index-nav"><i class="fa fa-warning"></i>Smells</a>
          </li>
          <li class="sidebar-item">
            <a href="../../../../simple_cov_index.html" class="project-nav-item coverage-index-nav"><i class="fa fa-umbrella"></i>Coverage</a>
          </li>
        </ul>
      </aside>
      <!-- /#sidebar-wrapper -->
      <div id="page-content-wrapper">
        <div class="container-fluid">
          <div class="row">
  <!--Page Title -->
  <div class="Page_Title">
    <div class="file-time">
      <span class="committed-at">
        
          Updated <time class='js-timeago' datetime='2025-07-08 13:57:23 -0600'>2025-07-08 13:57:23 -0600</time>
        
      </span>
    </div>
    <div>
      <h3><small>spec/requests/api/v1 /</small> garden_plants_request_spec.rb</h3>
    </div>
  </div>
  <!--End Page Title -->
  <div class="Content_Wrapper">
    <!-- code detail -->
    <div class="code-top-detail clearfix row">
      <div class="col-md-8">
        <div class="row">
          <div class="col-md-1">
            <div class="rating f big">
              F
            </div>
          </div>
          <div class="code-statistics col-md-11">
            <div class="col-md-3">
              <div><span class="metric">925</span><small> lines of codes</small></div>
              <div><span class="metric">0</span><small> methods</small></div>
            </div>
            <div class="col-md-3">
              <div><span class="metric">N/A</span><small> complexity/method</small></div>
              <div><span class="metric">81</span><small> churn</small></div>
            </div>
            <div class="col-md-3">
              <div><span class="metric">2722.11</span><small> complexity</small></div>
              <div><span class="metric">867</span><small> duplications</small></div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="code-tabs">
          <ul class="nav nav-pills right-to-left">
            <li><a href="#" id="toggle-code" class="toggle-button button">code</a></li>
            <li class="active">
              <a href="#" id="toggle-smells" class="toggle-button button">
                35
                smells
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <code class="prettyprint linenums lang-ruby file-code js-file-code">require &#39;rails_helper&#39;

RSpec.describe &#39;Garden Plants API Endpoint&#39;, :vcr do
  before(:each) do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 4 nodes</span>              <span>Locations:</span>                  <a href="garden_plants_request_spec.html#L4" class="js-smell-location">0</a>                  <a href="plants_in_the_garden_request_spec.html#L4" class="js-smell-location">1</a>                  <a href="plants_waiting_to_be_started_request_spec.html#L4" class="js-smell-location">2</a>                  <a href="started_indoor_seeds_request_spec.html#L4" class="js-smell-location">3</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>before#each has a flog score of 57</span>          </div>  </li></ol>
    ActiveRecord::Base.skip_callbacks = false

    # @user = User.create(
    #   name: &#39;Joel Grant&#39;,
    #   email: &#39;joel@plantcoach.com&#39;,
    #   zip_code: &#39;80121&#39;,
    #   password: &#39;12345&#39;,
    #   password_confirmation: &#39;12345&#39;
    # )

    body = {
      name: &#39;Joel Grant&#39;,
      email: &#39;joel@plantcoach.com&#39;,
      zip_code: &#39;80121&#39;,
      password: &#39;12345&#39;,
      password_confirmation: &#39;12345&#39;
    }
    post &#39;/api/v1/users&#39;, params: body

    @user_response = JSON.parse(response.body, symbolize_names: true)
    @user = User.find_by_id(@user_response[:user][:data][:id])

    @user.plant_guides.create(
      plant_type: &#39;Something else&#39;,
      seedling_days_to_transplant: 0,
      direct_seed_recommended: true,
      days_to_maturity: 45,
      days_relative_to_frost_date: 14,
      harvest_period: &#39;one_time&#39;
    )

    @tomato_guide = @user.plant_guides.create(
      plant_type: &#39;Tomato&#39;,
      seedling_days_to_transplant: 49,
      direct_seed_recommended: false,
      days_to_maturity: 45,
      days_relative_to_frost_date: 14,
      harvest_period: &#39;season_long&#39;
    )

    @user.plant_guides.create(
      plant_type: &#39;Pepper&#39;,
      seedling_days_to_transplant: 49,
      direct_seed_recommended: false,
      days_to_maturity: 45,
      days_relative_to_frost_date: 14,
      harvest_period: &#39;season_long&#39;
    )
    @user.plant_guides.create(
      plant_type: &#39;Eggplant&#39;,
      seedling_days_to_transplant: 49,
      direct_seed_recommended: false,
      days_to_maturity: 45,
      days_relative_to_frost_date: 14,
      harvest_period: &#39;season_long&#39;
    )
    @user.plant_guides.create(
      plant_type: &#39;Romaine Lettuce&#39;,
      seedling_days_to_transplant: 0,
      direct_seed_recommended: true,
      days_to_maturity: 45,
      days_relative_to_frost_date: 14,
      harvest_period: &#39;one_time&#39;
    )
    @user.plant_guides.create(
      plant_type: &#39;Green Bean&#39;,
      seedling_days_to_transplant: 0,
      direct_seed_recommended: true,
      days_to_maturity: 45,
      days_relative_to_frost_date: 14,
      harvest_period: &#39;season_long&#39;
    )
    @user.plant_guides.create(
      plant_type: &#39;Radish&#39;,
      seedling_days_to_transplant: 0,
      direct_seed_recommended: true,
      days_to_maturity: 45,
      days_relative_to_frost_date: 14,
      harvest_period: &#39;one_time&#39;
    )
    @user.plant_guides.create(
      plant_type: &#39;Carrot&#39;,
      seedling_days_to_transplant: 0,
      direct_seed_recommended: true,
      days_to_maturity: 60,
      days_relative_to_frost_date: -30,
      harvest_period: &#39;one_week&#39;
    )
    @user.plant_guides.create(
      plant_type: &#39;Sprouting Broccoli&#39;,
      seedling_days_to_transplant: 0,
      direct_seed_recommended: true,
      days_to_maturity: 45,
      days_relative_to_frost_date: -30,
      harvest_period: &#39;four_week&#39;
    )
    @user.plant_guides.create(
      plant_type: &#39;Basil&#39;,
      seedling_days_to_transplant: 0,
      direct_seed_recommended: true,
      days_to_maturity: 30,
      days_relative_to_frost_date: 0,
      harvest_period: &#39;three_week&#39;
    )
    @user.plant_guides.create(
      plant_type: &#39;Cilantro&#39;,
      seedling_days_to_transplant: 0,
      direct_seed_recommended: true,
      days_to_maturity: 30,
      days_relative_to_frost_date: 0,
      harvest_period: &#39;two_week&#39;
    )

    #   body = {
    #   name: &#39;Joel Grant&#39;,
    #   email: &#39;joel@plantcoach.com&#39;,
    #   zip_code: &#39;80121&#39;,
    #   password: &#39;12345&#39;,
    #   password_confirmation: &#39;12345&#39;
    # }

    # post &#39;/api/v1/users&#39;, params: body
    # binding.pry;
  end

  # let(:body) {{
  #   name: &#39;Joel Grant&#39;,
  #   email: &#39;joel@plantcoach.com&#39;,
  #   zip_code: &#39;80121&#39;,
  #   password: &#39;12345&#39;,
  #   password_confirmation: &#39;12345&#39;
  # }}
  # binding.pry;
  # let(:user_response) { JSON.parse(response.body, symbolize_names: true) }
  # let(:user) { User.find_by_id(user_response[:user][:data][:id]) }

  let(:plant1_object) do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="garden_plants_request_spec.html#L141" class="js-smell-location">0</a>                  <a href="garden_plants_request_spec.html#L152" class="js-smell-location">1</a>                  </div>  </li></ol>
    @user.plants.create!(
      plant_type: &#39;Tomato&#39;,
      name: &#39;Sungold&#39;,
      days_relative_to_frost_date: 14,
      days_to_maturity: 54,
      hybrid_status: 1,
      organic: false
    )
  end

  let(:plant2_object) do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="garden_plants_request_spec.html#L141" class="js-smell-location">0</a>                  <a href="garden_plants_request_spec.html#L152" class="js-smell-location">1</a>                  </div>  </li></ol>
    @user.plants.create!(
      plant_type: &#39;Pepper&#39;,
      name: &#39;Jalafuego&#39;,
      days_relative_to_frost_date: 14,
      days_to_maturity: 65,
      hybrid_status: 1,
      organic: false
    )
  end

  let(:plant3_object) do
    @user.plants.create!(
      plant_type: &#39;Basil&#39;,
      name: &#39;Thai Towers&#39;
    )
  end

  let(:plant4_object) do
    @user.plants.create!(
      plant_type: &#39;Sprouting Broccoli&#39;,
      name: &#39;Di Cicco&#39;
    )
  end

  let(:plant5_object) do
    @user.plants.create!(
      plant_type: &#39;Cucumber&#39;,
      name: &#39;Corinto&#39;
    )
  end

  let(:plant6_object) do
    @user.plants.create!(
      plant_type: &#39;Carrot&#39;,
      name: &#39;SugarSnax&#39;,
      days_relative_to_frost_date: -30,
      days_to_maturity: 60
    )
  end

  let(:plant7_object) do
    @user.plants.create!(
      plant_type: &#39;Romaine Lettuce&#39;,
      name: &#39;Coastal Star&#39;
    )
  end
  let(:plant8_object) do
    @user.plants.create!(
      plant_type: &#39;Cilantro&#39;,
      name: &#39;Santo&#39;
    )
  end

  describe &#39;POST garden plants&#39; do
    context &#39;starting a plant from seed&#39; do
      context &#39;outside&#39; do
        context &#39;right now&#39; do
          # This only works when both the seed-start date and the actual transplant date are provided.
          # Only the actual_seed_sewing_date is necessary if the rails dirty call backs were working.
          it &#39;creates a garden plant that has an updated planting status&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(POST garden plants)::context(starting a plant from seed)::context(outside)::context(right now)::it#creates a garden plant that has an updated planting status has a flog score of 83</span>          </div>  </li></ol>
            post &#39;/api/v1/garden_plants&#39;, params: {<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="garden_plants_request_spec.html#L213" class="js-smell-location">0</a>                  <a href="garden_plants_request_spec.html#L233" class="js-smell-location">1</a>                  </div>  </li></ol>
                                            plant_id: plant1_object.id,
                                            plant_start_method: :direct_sew,
                                            actual_seed_sewing_date: Date.today,
                                            planting_status: &#39;direct_sewn_outside&#39;
                                          },
                                          headers: {
                                            Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
                                          }
            result = JSON.parse(response.body, symbolize_names: true)

            expect(response).to be_successful

            expect(result[:data][:attributes][:planting_status]).to eq(&#39;direct_sewn_outside&#39;)
            expect(result[:data][:attributes][:actual_seed_sewing_date].to_date).to eq(Date.today)
            expect(result[:data][:attributes][:recommended_transplant_date]).to be nil
            expect(result[:data][:attributes][:plant_id]).to_not be nil
          end

          it &#39;provides an expected date range that the plant will have for a period of harvest&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(POST garden plants)::context(starting a plant from seed)::context(outside)::context(right now)::it#provides an expected date range that the plant will have for a period of harvest has a flog score of 77</span>          </div>  </li></ol>
            post &#39;/api/v1/garden_plants&#39;, params: {<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="garden_plants_request_spec.html#L213" class="js-smell-location">0</a>                  <a href="garden_plants_request_spec.html#L233" class="js-smell-location">1</a>                  </div>  </li></ol>
                                            plant_id: plant1_object.id,
                                            plant_start_method: :direct_sew,
                                            actual_seed_sewing_date: Date.today,
                                            planting_status: &#39;transplanted_outside&#39;
                                          },
                                          headers: {
                                            Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
                                          }

            result = JSON.parse(response.body, symbolize_names: true)

            expect(response).to be_successful

            transplant_date = @user.spring_frost_date.to_date + plant1_object.days_relative_to_frost_date
            days_to_maturity = plant1_object.days_to_maturity

            harvest_start = transplant_date + days_to_maturity
            harvest_finish = @user.fall_frost_date.to_date

            expect(result[:data][:attributes][:harvest_start].to_date).to eq(harvest_start)
            expect(result[:data][:attributes][:harvest_finish].to_date).to eq(harvest_finish)
          end

          it &#39;provides a harvest range that is shorter for limited-harvest plants&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(POST garden plants)::context(starting a plant from seed)::context(outside)::context(right now)::it#provides a harvest range that is shorter for limited-harvest plants has a flog score of 74</span>          </div>  </li></ol>
            post &#39;/api/v1/garden_plants&#39;, params: {
                                            plant_id: plant3_object.id,
                                            plant_start_method: :direct_sew,
                                            actual_seed_sewing_date: &#39;2023-05-20&#39;,
                                            plant_type: &#39;Basil&#39;
                                          },
                                          headers: {
                                            Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
                                          }

            result = JSON.parse(response.body, symbolize_names: true)

            expect(response).to be_successful

            transplant_date = @user.spring_frost_date.to_date + plant3_object.days_relative_to_frost_date
            days_to_maturity = plant3_object.days_to_maturity

            harvest_start = transplant_date + days_to_maturity
            harvest_finish = harvest_start + 21

            expect(result[:data][:attributes][:harvest_start].to_date).to eq(harvest_start)
            expect(result[:data][:attributes][:harvest_finish].to_date).to eq(harvest_finish)
          end
        end

        context &#39;in the future&#39; do
          it &#39;creates a garden plant that has the information needed to be planted later&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(POST garden plants)::context(starting a plant from seed)::context(outside)::context(in the future)::it#creates a garden plant that has the information needed to be planted later has a flog score of 47</span>          </div>  </li></ol>
            post &#39;/api/v1/garden_plants&#39;, params: {
                                            plant_id: plant1_object.id,
                                            plant_start_method: :direct_sew
                                          },
                                          headers: {
                                            Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
                                          }

            result = JSON.parse(response.body, symbolize_names: true)

            expect(response).to be_successful

            expect(result[:data][:attributes][:planting_status]).to eq(&#39;not_started&#39;)
            expect(result[:data][:attributes][:recommended_seed_sewing_date]).to_not be nil
          end
        end
      end

      context &#39;inside&#39; do
        context &#39;right now&#39; do
          it &#39;creates new plant that the user will be planting&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(POST garden plants)::context(starting a plant from seed)::context(inside)::context(right now)::it#creates new plant that the user will be planting has a flog score of 138</span>          </div>  </li></ol>
            post &#39;/api/v1/garden_plants&#39;, params: {
                                            plant_id: plant1_object.id,
                                            plant_start_method: :indirect_sew,
                                            actual_seed_sewing_date: Date.today
                                          },
                                          headers: {
                                            Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
                                          }

            result = JSON.parse(response.body, symbolize_names: true)
            new_plant = GardenPlant.last

            expect(response).to be_successful

            expect(new_plant.id).to eq(result[:data][:id].to_i)

            expect(result).to be_a Hash
            expect(result).to have_key(:data)

            expect(result[:data]).to be_a Hash

            expect(result[:data][:attributes][:planting_status]).to eq(&#39;started_indoors&#39;)

            expect(result[:data][:attributes]).to have_key(:recommended_transplant_date)
            expect(result[:data][:attributes]).to have_key(:planting_status)
            expect(result[:data][:attributes]).to have_key(:direct_seed_recommended)
            expect(result[:data][:attributes]).to have_key(:recommended_seed_sewing_date)
            expect(result[:data][:attributes]).to have_key(:actual_seed_sewing_date)
            expect(result[:data][:attributes]).to have_key(:seedling_days_to_transplant)
          end
          # likely to delete
          it &#39;will return a json error message if there was a problem&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(POST garden plants)::context(starting a plant from seed)::context(inside)::context(right now)::it#will return a json error message if there was a problem has a flog score of 37</span>          </div>  </li></ol>
            post &#39;/api/v1/garden_plants&#39;, params: { plant_id: 99_999_999_999 }, headers: {
              Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
            }

            result = JSON.parse(response.body, symbolize_names: true)

            expect(response.status).to eq(400)

            expect(result).to have_key(:error)
            expect(result[:error]).to eq(&#39;There was a problem finding a plant to copy!&#39;)
          end
        end

        context &#39;in the future&#39; do
          it &#39;creates a plant with the data needed to time its future transplanting&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(POST garden plants)::context(starting a plant from seed)::context(inside)::context(in the future)::it#creates a plant with the data needed to time its future transplanting has a flog score of 73</span>          </div>  </li></ol>
            post &#39;/api/v1/garden_plants&#39;, params: {
              plant_id: plant1_object.id,
              plant_start_method: :indirect_sew
            }, headers: {
              Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
            }

            result = JSON.parse(response.body, symbolize_names: true)

            expect(result[:data][:attributes][:planting_status]).to eq(&#39;not_started&#39;)
            expect(result[:data][:attributes][:recommended_seed_sewing_date].to_date).to be_a Date
            expect(result[:data][:attributes][:plant_start_method]).to eq(&#39;indirect_sew&#39;)
            expect(result[:data][:attributes][:recommended_transplant_date].to_date).to be_a Date
          end

          it &#39;establishes the plants harvest period and harvest dates for a season-long-harvest plant such as a tomato&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(POST garden plants)::context(starting a plant from seed)::context(inside)::context(in the future)::it#establishes the plants harvest period and harvest dates for a season-long-harvest plant such as a tomato has a flog score of 165</span>          </div>  </li></ol>
            post &#39;/api/v1/garden_plants&#39;, params: {
              plant_id: plant1_object.id,
              plant_start_method: :indirect_sew
            }, headers: {
              Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
            }

            result = JSON.parse(response.body, symbolize_names: true)

            expect(result[:data][:attributes][:planting_status]).to eq(&#39;not_started&#39;)
            expect(result[:data][:attributes][:recommended_seed_sewing_date].to_date).to be_a Date
            expect(result[:data][:attributes][:plant_start_method]).to eq(&#39;indirect_sew&#39;)
            expect(result[:data][:attributes][:recommended_transplant_date].to_date).to be_a Date

            expect(result[:data][:attributes]).to have_key(:harvest_period)
            expect(result[:data][:attributes]).to have_key(:harvest_start)
            expect(result[:data][:attributes]).to have_key(:harvest_finish)

            expected_harvest_start = result[:data][:attributes][:recommended_transplant_date].to_date + 54
            expected_harvest_finish = @user.fall_frost_date

            expect(result[:data][:attributes][:harvest_period]).to eq(&#39;season_long&#39;)
            expect(result[:data][:attributes][:harvest_start].to_date).to eq(expected_harvest_start)
            expect(result[:data][:attributes][:harvest_finish].to_date).to eq(expected_harvest_finish.to_date)
          end

          it &#39;establishes the plants harvest period and harvest dates for a four-week long harvested plant such as sprouting broccoli&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(POST garden plants)::context(starting a plant from seed)::context(inside)::context(in the future)::it#establishes the plants harvest period and harvest dates for a four-week long harvested plant such as sprouting broccoli has a flog score of 152</span>          </div>  </li></ol>
            post &#39;/api/v1/garden_plants&#39;, params: {
              plant_id: plant4_object.id,
              plant_start_method: :indirect_sew
            }, headers: {
              Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
            }

            result = JSON.parse(response.body, symbolize_names: true)

            expect(result[:data][:attributes][:planting_status]).to eq(&#39;not_started&#39;)
            expect(result[:data][:attributes][:recommended_seed_sewing_date].to_date).to be_a Date
            expect(result[:data][:attributes][:plant_start_method]).to eq(&#39;indirect_sew&#39;)

            expect(result[:data][:attributes]).to have_key(:harvest_period)
            expect(result[:data][:attributes]).to have_key(:harvest_start)
            expect(result[:data][:attributes]).to have_key(:harvest_finish)

            four_weeks_in_days = 4 * 7
            expected_harvest_start = result[:data][:attributes][:recommended_transplant_date].to_date + 45
            expected_harvest_finish = expected_harvest_start + four_weeks_in_days

            expect(result[:data][:attributes][:harvest_period]).to eq(&#39;four_week&#39;)
            expect(result[:data][:attributes][:harvest_start].to_date).to eq(expected_harvest_start)
            expect(result[:data][:attributes][:harvest_finish].to_date).to eq(expected_harvest_finish.to_date)
          end

          it &#39;establishes the plants harvest period and harvest dates for a three-week long harvested plant such as a cucumber&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="garden_plants_request_spec.html#L422" class="js-smell-location">0</a>                  <a href="garden_plants_request_spec.html#L449" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(POST garden plants)::context(starting a plant from seed)::context(inside)::context(in the future)::it#establishes the plants harvest period and harvest dates for a three-week long harvested plant such as a cucumber has a flog score of 153</span>          </div>  </li></ol>
            post &#39;/api/v1/garden_plants&#39;, params: {
              plant_id: plant3_object.id,
              plant_start_method: :indirect_sew
            }, headers: {
              Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
            }

            result = JSON.parse(response.body, symbolize_names: true)

            expect(result[:data][:attributes][:planting_status]).to eq(&#39;not_started&#39;)
            expect(result[:data][:attributes][:recommended_seed_sewing_date].to_date).to be_a Date
            expect(result[:data][:attributes][:plant_start_method]).to eq(&#39;indirect_sew&#39;)

            expect(result[:data][:attributes]).to have_key(:harvest_period)
            expect(result[:data][:attributes]).to have_key(:harvest_start)
            expect(result[:data][:attributes]).to have_key(:harvest_finish)

            three_weeks_in_days = 3 * 7
            expected_harvest_start = result[:data][:attributes][:recommended_transplant_date].to_date + plant3_object.days_to_maturity
            expected_harvest_finish = expected_harvest_start + three_weeks_in_days

            expect(result[:data][:attributes][:harvest_period]).to eq(&#39;three_week&#39;)
            expect(result[:data][:attributes][:harvest_start].to_date).to eq(expected_harvest_start)
            expect(result[:data][:attributes][:harvest_finish].to_date).to eq(expected_harvest_finish)
          end

          it &#39;establishes the plants harvest period and harvest dates for a two-week long harvested plant such as cilantro&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="garden_plants_request_spec.html#L422" class="js-smell-location">0</a>                  <a href="garden_plants_request_spec.html#L449" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(POST garden plants)::context(starting a plant from seed)::context(inside)::context(in the future)::it#establishes the plants harvest period and harvest dates for a two-week long harvested plant such as cilantro has a flog score of 153</span>          </div>  </li></ol>
            post &#39;/api/v1/garden_plants&#39;, params: {
              plant_id: plant8_object.id,
              plant_start_method: :indirect_sew
            }, headers: {
              Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
            }

            result = JSON.parse(response.body, symbolize_names: true)

            expect(result[:data][:attributes][:planting_status]).to eq(&#39;not_started&#39;)
            expect(result[:data][:attributes][:recommended_seed_sewing_date].to_date).to be_a Date
            expect(result[:data][:attributes][:plant_start_method]).to eq(&#39;indirect_sew&#39;)

            expect(result[:data][:attributes]).to have_key(:harvest_period)
            expect(result[:data][:attributes]).to have_key(:harvest_start)
            expect(result[:data][:attributes]).to have_key(:harvest_finish)

            two_weeks_in_days = 2 * 7
            expected_harvest_start = result[:data][:attributes][:recommended_transplant_date].to_date + plant8_object.days_to_maturity
            expected_harvest_finish = expected_harvest_start + two_weeks_in_days

            expect(result[:data][:attributes][:harvest_period]).to eq(&#39;two_week&#39;)
            expect(result[:data][:attributes][:harvest_start].to_date).to eq(expected_harvest_start)
            expect(result[:data][:attributes][:harvest_finish].to_date).to eq(expected_harvest_finish)
          end

          it &#39;establishes the plants harvest period and harvest dates for a 1-week long harvested plant such as carrots&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(POST garden plants)::context(starting a plant from seed)::context(inside)::context(in the future)::it#establishes the plants harvest period and harvest dates for a 1-week long harvested plant such as carrots has a flog score of 167</span>          </div>  </li></ol>
            post &#39;/api/v1/garden_plants&#39;, params: {
              plant_id: plant6_object.id,
              plant_start_method: :indirect_sew
            }, headers: {
              Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
            }

            result = JSON.parse(response.body, symbolize_names: true)

            expect(result[:data][:attributes][:planting_status]).to eq(&#39;not_started&#39;)
            expect(result[:data][:attributes][:recommended_seed_sewing_date].to_date).to be_a Date
            expect(result[:data][:attributes][:plant_start_method]).to eq(&#39;indirect_sew&#39;)
            expect(result[:data][:attributes][:recommended_transplant_date].to_date).to be_a Date

            expect(result[:data][:attributes]).to have_key(:harvest_period)
            expect(result[:data][:attributes]).to have_key(:harvest_start)
            expect(result[:data][:attributes]).to have_key(:harvest_finish)

            one_week_in_days = 7
            expected_harvest_start = result[:data][:attributes][:recommended_transplant_date].to_date + plant6_object.days_to_maturity
            expected_harvest_finish = expected_harvest_start + one_week_in_days

            expect(result[:data][:attributes][:harvest_period]).to eq(&#39;one_week&#39;)
            expect(result[:data][:attributes][:harvest_start].to_date).to eq(expected_harvest_start)
            expect(result[:data][:attributes][:harvest_finish].to_date).to eq(expected_harvest_finish)
          end

          it &#39;establishes the plants harvest period and harvest dates for a one-time harvested plant such as a head of lettuce&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(POST garden plants)::context(starting a plant from seed)::context(inside)::context(in the future)::it#establishes the plants harvest period and harvest dates for a one-time harvested plant such as a head of lettuce has a flog score of 164</span>          </div>  </li></ol>
            post &#39;/api/v1/garden_plants&#39;, params: {
              plant_id: plant7_object.id,
              plant_start_method: :indirect_sew
            }, headers: {
              Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
            }

            result = JSON.parse(response.body, symbolize_names: true)

            expect(result[:data][:attributes][:planting_status]).to eq(&#39;not_started&#39;)
            expect(result[:data][:attributes][:recommended_seed_sewing_date].to_date).to be_a Date
            expect(result[:data][:attributes][:plant_start_method]).to eq(&#39;indirect_sew&#39;)
            expect(result[:data][:attributes][:recommended_transplant_date].to_date).to be_a Date

            expect(result[:data][:attributes]).to have_key(:harvest_period)
            expect(result[:data][:attributes]).to have_key(:harvest_start)
            expect(result[:data][:attributes]).to have_key(:harvest_finish)

            expected_harvest_start = result[:data][:attributes][:recommended_transplant_date].to_date + plant7_object.days_to_maturity
            expected_harvest_finish = expected_harvest_start

            expect(result[:data][:attributes][:harvest_period]).to eq(&#39;one_time&#39;)
            expect(result[:data][:attributes][:harvest_start].to_date).to eq(expected_harvest_start)
            expect(result[:data][:attributes][:harvest_finish].to_date).to eq(expected_harvest_finish)
          end
        end
      end
    end

    context &#39;starting as a plant&#39; do
      context &#39;right now&#39; do
        # This could now be re-written to provide an error message that helps the fe development rather than for the end user.
        xit &#39;creates a garden plant that is updated with information relevant to being place outside&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(POST garden plants)::context(starting as a plant)::context(right now)::xit#creates a garden plant that is updated with information relevant to being place outside has a flog score of 78</span>          </div>  </li></ol>
          post &#39;/api/v1/garden_plants&#39;, params: {
            plant_id: plant2_object.id,
            # This...
            actual_transplant_date: Date.today
          }, headers: {
            Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
          }

          result = JSON.parse(response.body, symbolize_names: true)

          expect(result[:data][:attributes][:planting_status]).to eq(&#39;transplanted_outside&#39;)

          expect(result[:data][:attributes][:plant_start_method]).to eq(&#39;not_applicable&#39;)
          expect(result[:data][:attributes][:actual_seed_sewing_date]).to be nil
          expect(result[:data][:attributes][:recommended_seed_sewing_date].to_date).to be_a Date
          expect(result[:data][:attributes][:direct_seed_recommended]).to_not be nil
        end
      end

      context &#39;in the future&#39; do
        it &#39;creates a garden plant that is scheduled with a planting in the future&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(POST garden plants)::context(starting as a plant)::context(in the future)::it#creates a garden plant that is scheduled with a planting in the future has a flog score of 50</span>          </div>  </li></ol>
          post &#39;/api/v1/garden_plants&#39;, params: {
            plant_id: plant2_object.id

          }, headers: {
            Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
          }

          result = JSON.parse(response.body, symbolize_names: true)

          expect(result[:data][:attributes][:planting_status]).to eq(&#39;not_started&#39;)
          expect(result[:data][:attributes][:actual_seed_sewing_date]).to be nil
          expect(result[:data][:attributes][:recommended_seed_sewing_date]).to_not be nil
        end
      end
    end
  end

  describe &#39;GET /garden_plants&#39; do
    it &#39;retrieves an array of the plants that belong to the user&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(GET /garden_plants)::it#retrieves an array of the plants that belong to the user has a flog score of 206</span>          </div>  </li></ol>
      @user.plants.create!(
        plant_type: &#39;Something else&#39;,
        name: &quot;A plant you shouldn&#39;t see&quot;,
        days_relative_to_frost_date: 14,
        days_to_maturity: 65,
        hybrid_status: 1,
        organic: false
      )
      plant1_object.garden_plants.create!(
        {
          plant_start_method: :indirect_sew,
          planting_status: &#39;not_started&#39;
        }
      )
      plant2_object.garden_plants.create!(
        {
          plant_start_method: :indirect_sew,
          planting_status: &#39;not_started&#39;
        }
      )

      get &#39;/api/v1/garden_plants&#39;, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }
      result = JSON.parse(response.body, symbolize_names: true)

      expect(result).to be_a Hash
      expect(result[:data]).to be_an Array

      expect(result[:data].count).to eq(2)

      result[:data].each do |plant|
        expect(plant[:attributes][:plant][:name]).to be_a String
        expect(plant[:attributes][:plant][:plant_type]).to be_a String
        expect(plant[:attributes][:plant][:days_to_maturity]).to be_a Integer
        expect(plant[:attributes][:plant][:hybrid_status]).to be_a String
        expect(plant[:attributes][:plant][:organic]).to be_in [true, false]
        expect(plant[:attributes][:plant][:days_relative_to_frost_date]).to be_a Integer
        expect(plant[:attributes][:plant][:user_id]).to be_a Integer
        expect(plant[:attributes][:plant][:harvest_period]).to be_a String
        expect(plant[:attributes][:recommended_transplant_date]).to be_a String
        expect(plant[:attributes][:plant_start_method]).to be_a String
        expect(plant[:attributes][:recommended_seed_sewing_date]).to be_a String
        expect(plant[:attributes][:seedling_days_to_transplant]).to be_a Integer
        expect(plant[:attributes][:harvest_start]).to be_a String
        expect(plant[:attributes][:harvest_finish]).to be_a String
        expect(plant[:attributes][:harvest_period]).to be_a String
      end
    end
  end

  describe &#39;PATCH /garden_plants&#39; do
    context &#39;when updating a GardenPlants planting status&#39; do
      describe &#39;from not started to started indoors&#39; do
        it &#39;returns will update the planting status and the seed-sewing date&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(PATCH /garden_plants)::context(when updating a GardenPlants planting status)::describe(from not started to started indoors)::it#returns will update the planting status and the seed-sewing date has a flog score of 77</span>          </div>  </li></ol>
          post &#39;/api/v1/garden_plants&#39;, params: {
            plant_id: plant1_object.id,
            actual_seed_sewing_date: nil,
            plant_start_method: :indirect_sew,
            planting_status: &#39;not_started&#39;
          }, headers: {
            Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
          }

          new_garden_plant = @user.plants.find_by_id(plant1_object.id).garden_plants.first

          patch &quot;/api/v1/garden_plants/#{new_garden_plant.id}&quot;, params: {<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 3 nodes</span>              <span>Locations:</span>                  <a href="garden_plants_request_spec.html#L644" class="js-smell-location">0</a>                  <a href="garden_plants_request_spec.html#L764" class="js-smell-location">1</a>                  <a href="garden_plants_request_spec.html#L790" class="js-smell-location">2</a>                  </div>  </li></ol>
            planting_status: &#39;started_indoors&#39;,
            actual_seed_sewing_date: Date.today
          }, headers: {
            Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
          }
          result = JSON.parse(response.body, symbolize_names: true)

          expect(result[:data][:attributes][:planting_status]).to eq(&#39;started_indoors&#39;)
          expect(result[:data][:attributes][:actual_seed_sewing_date]).to_not be nil
          expect(result[:data][:attributes][:actual_seed_sewing_date].to_date).to eq(Date.today)
        end

        it &#39;returns a meaningful error response if the frontend doesnt provide...&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(PATCH /garden_plants)::context(when updating a GardenPlants planting status)::describe(from not started to started indoors)::it#returns a meaningful error response if the frontend doesnt provide... has a flog score of 41</span>          </div>  </li></ol>
          post &#39;/api/v1/garden_plants&#39;, params: {
            plant_id: plant1_object.id,
            actual_seed_sewing_date: nil,
            plant_start_method: :indirect_sew,
            planting_status: :not_started
          }, headers: {
            Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
          }

          new_garden_plant = @user.plants.find_by_id(plant1_object.id).garden_plants.first

          patch &quot;/api/v1/garden_plants/#{new_garden_plant.id}&quot;, params: {<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="garden_plants_request_spec.html#L669" class="js-smell-location">0</a>                  <a href="garden_plants_request_spec.html#L718" class="js-smell-location">1</a>                  </div>  </li></ol>
            planting_status: :started_indoors
          }, headers: {
            Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
          }
          result = JSON.parse(response.body, symbolize_names: true)

          expect(result[:error]).to eq(&#39;You must specify a seed-sewing date!&#39;)
        end
      end

      describe &#39;from Started Indoors to Transplanted Outside&#39; do
        it &#39;will update the planting status and the actual transplant date&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(PATCH /garden_plants)::context(when updating a GardenPlants planting status)::describe(from Started Indoors to Transplanted Outside)::it#will update the planting status and the actual transplant date has a flog score of 79</span>          </div>  </li></ol>
          post &#39;/api/v1/garden_plants&#39;, params: {
            plant_id: plant1_object.id,
            actual_seed_sewing_date: Date.yesterday,
            plant_start_method: :indirect_sew,
            planting_status: :started_indoors
          }, headers: {
            Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
          }

          new_garden_plant = @user.plants.find_by_id(plant1_object.id).garden_plants.first

          patch &quot;/api/v1/garden_plants/#{new_garden_plant.id}&quot;, params: {
            planting_status: :transplanted_outside,
            actual_transplant_date: Date.today
          }, headers: {
            Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
          }
          result = JSON.parse(response.body, symbolize_names: true)

          expect(result[:data][:attributes][:planting_status]).to eq(&#39;transplanted_outside&#39;)
          expect(result[:data][:attributes][:actual_transplant_date]).to_not be nil
          expect(result[:data][:attributes][:actual_transplant_date].to_date).to eq(Date.today)
        end

        it &#39;returns a meaningful error response if the frontend doesnt provide...&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(PATCH /garden_plants)::context(when updating a GardenPlants planting status)::describe(from Started Indoors to Transplanted Outside)::it#returns a meaningful error response if the frontend doesnt provide... has a flog score of 41</span>          </div>  </li></ol>
          post &#39;/api/v1/garden_plants&#39;, params: {
            plant_id: plant1_object.id,
            actual_seed_sewing_date: nil,
            plant_start_method: :indirect_sew,
            planting_status: &#39;not_started&#39;
          }, headers: {
            Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
          }

          new_garden_plant = @user.plants.find_by_id(plant1_object.id).garden_plants.first

          patch &quot;/api/v1/garden_plants/#{new_garden_plant.id}&quot;, params: {<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="garden_plants_request_spec.html#L669" class="js-smell-location">0</a>                  <a href="garden_plants_request_spec.html#L718" class="js-smell-location">1</a>                  </div>  </li></ol>
            planting_status: :transplanted_outside
          }, headers: {
            Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
          }
          result = JSON.parse(response.body, symbolize_names: true)

          expect(result[:error]).to eq(&#39;You must specify a transplant date!&#39;)
        end
      end

      describe &#39;from not started to transplanted outside&#39; do
        it &#39;will return a meaningful error response if the frontend doesnt provide an actual transplant date&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="garden_plants_request_spec.html#L730" class="js-smell-location">0</a>                  <a href="garden_plants_request_spec.html#L804" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(PATCH /garden_plants)::context(when updating a GardenPlants planting status)::describe(from not started to transplanted outside)::it#will return a meaningful error response if the frontend doesnt provide an actual transplant date has a flog score of 41</span>          </div>  </li></ol>
          post &#39;/api/v1/garden_plants&#39;, params: {
            plant_id: plant1_object.id,
            actual_seed_sewing_date: nil,
            plant_start_method: :indirect_sew,
            planting_status: &#39;not_started&#39;
          }, headers: {
            Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
          }

          new_garden_plant = @user.plants.find_by_id(plant1_object.id).garden_plants.first

          patch &quot;/api/v1/garden_plants/#{new_garden_plant.id}&quot;, params: {
            planting_status: &#39;transplanted_outside&#39;
          }, headers: {
            Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
          }
          result = JSON.parse(response.body, symbolize_names: true)

          expect(result[:error]).to eq(&#39;You must specify a transplant date!&#39;)
        end

        it &#39;will only update the object when an actual_transplant_date is passed&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(PATCH /garden_plants)::context(when updating a GardenPlants planting status)::describe(from not started to transplanted outside)::it#will only update the object when an actual_transplant_date is passed has a flog score of 65</span>          </div>  </li></ol>
          post &#39;/api/v1/garden_plants&#39;, params: {
            plant_id: plant1_object.id,
            actual_seed_sewing_date: nil,
            plant_start_method: :indirect_sew,
            planting_status: &#39;not_started&#39;
          }, headers: {
            Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
          }

          new_garden_plant = @user.plants.find_by_id(plant1_object.id).garden_plants.first

          patch &quot;/api/v1/garden_plants/#{new_garden_plant.id}&quot;, params: {<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 3 nodes</span>              <span>Locations:</span>                  <a href="garden_plants_request_spec.html#L644" class="js-smell-location">0</a>                  <a href="garden_plants_request_spec.html#L764" class="js-smell-location">1</a>                  <a href="garden_plants_request_spec.html#L790" class="js-smell-location">2</a>                  </div>  </li></ol>
            planting_status: &#39;transplanted_outside&#39;,
            actual_transplant_date: Date.today
          }, headers: {
            Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
          }
          result = JSON.parse(response.body, symbolize_names: true)

          expect(result[:data][:attributes][:planting_status]).to eq(&#39;transplanted_outside&#39;)
          expect(result[:data][:attributes][:actual_transplant_date].to_date).to eq(Date.today)
        end
      end

      describe &#39;from Not Started to Direct Seeded Outside&#39; do
        it &#39;will update the status and transplant date&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(PATCH /garden_plants)::context(when updating a GardenPlants planting status)::describe(from Not Started to Direct Seeded Outside)::it#will update the status and transplant date has a flog score of 77</span>          </div>  </li></ol>
          post &#39;/api/v1/garden_plants&#39;, params: {
            plant_id: plant1_object.id,
            actual_seed_sewing_date: nil,
            plant_start_method: :direct_sew,
            planting_status: &#39;not_started&#39;
          }, headers: {
            Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
          }

          new_garden_plant = @user.plants.find_by_id(plant1_object.id).garden_plants.first

          patch &quot;/api/v1/garden_plants/#{new_garden_plant.id}&quot;, params: {<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 3 nodes</span>              <span>Locations:</span>                  <a href="garden_plants_request_spec.html#L644" class="js-smell-location">0</a>                  <a href="garden_plants_request_spec.html#L764" class="js-smell-location">1</a>                  <a href="garden_plants_request_spec.html#L790" class="js-smell-location">2</a>                  </div>  </li></ol>
            planting_status: &#39;direct_sewn_outside&#39;,
            actual_seed_sewing_date: Date.today
          }, headers: {
            Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
          }
          result = JSON.parse(response.body, symbolize_names: true)

          expect(result[:data][:attributes][:planting_status]).to eq(&#39;direct_sewn_outside&#39;)
          expect(result[:data][:attributes][:actual_seed_sewing_date].to_date).to eq(Date.today)
          expect(result[:data][:attributes][:actual_transplant_date]).to be nil
          # expect(result[:data][:attributes][:actual_seed_sewing_date].to_date).to eq(Date.today)
        end

        it &#39;will return an error if the necessary information was not provided&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="garden_plants_request_spec.html#L730" class="js-smell-location">0</a>                  <a href="garden_plants_request_spec.html#L804" class="js-smell-location">1</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(PATCH /garden_plants)::context(when updating a GardenPlants planting status)::describe(from Not Started to Direct Seeded Outside)::it#will return an error if the necessary information was not provided has a flog score of 41</span>          </div>  </li></ol>
          post &#39;/api/v1/garden_plants&#39;, params: {
            plant_id: plant1_object.id,
            actual_seed_sewing_date: nil,
            plant_start_method: :direct_sew,
            planting_status: &#39;not_started&#39;
          }, headers: {
            Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
          }

          new_garden_plant = @user.plants.find_by_id(plant1_object.id).garden_plants.first

          patch &quot;/api/v1/garden_plants/#{new_garden_plant.id}&quot;, params: {
            planting_status: &#39;direct_sewn_outside&#39;
          }, headers: {
            Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
          }
          result = JSON.parse(response.body, symbolize_names: true)

          expect(result[:error]).to eq(&#39;You must specify a seed-sewing date!&#39;)
        end
      end
    end

    it &#39;allows the user to add an actual planting date to an existing garden_plant&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(PATCH /garden_plants)::it#allows the user to add an actual planting date to an existing garden_plant has a flog score of 173</span>          </div>  </li></ol>
      post &#39;/api/v1/garden_plants&#39;, params: {
        plant_id: plant1_object.id,
        actual_seed_sewing_date: nil,
        plant_start_method: :indirect_sew,
        planting_status: &#39;not_started&#39;
      }, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }

      result = JSON.parse(response.body, symbolize_names: true)
      garden_plant = @user.plants.find_by_id(plant1_object.id).garden_plants.first

      expect(response).to be_successful

      expect(garden_plant.id).to eq(result[:data][:id].to_i)

      expect(result).to be_a Hash
      expect(result).to have_key(:data)

      expect(result[:data]).to be_a Hash

      expect(result[:data][:attributes]).to have_key(:recommended_transplant_date)
      expect(result[:data][:attributes]).to have_key(:planting_status)
      expect(result[:data][:attributes][:planting_status]).to eq(&#39;not_started&#39;)

      expect(result[:data][:attributes]).to have_key(:direct_seed_recommended)
      expect(result[:data][:attributes]).to have_key(:recommended_seed_sewing_date)
      expect(result[:data][:attributes]).to have_key(:actual_seed_sewing_date)
      expect(result[:data][:attributes]).to have_key(:seedling_days_to_transplant)

      patch &quot;/api/v1/garden_plants/#{garden_plant.id}&quot;, params: {<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="garden_plants_request_spec.html#L859" class="js-smell-location">0</a>                  <a href="garden_plants_request_spec.html#L897" class="js-smell-location">1</a>                  </div>  </li></ol>
        actual_seed_sewing_date: Date.yesterday
      }, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }

      patch_result = JSON.parse(response.body, symbolize_names: true)

      expect(patch_result[:data][:attributes][:actual_seed_sewing_date].to_date).to eq(Date.yesterday)
      expect(patch_result[:data][:attributes][:recommended_transplant_date]).to eq((Date.yesterday + @tomato_guide.seedling_days_to_transplant).to_s)
    end

    it &#39;will add a transplant date to the garden_plant object when giving a plant a transplant date&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(PATCH /garden_plants)::it#will add a transplant date to the garden_plant object when giving a plant a transplant date has a flog score of 128</span>          </div>  </li></ol>
      post &#39;/api/v1/garden_plants&#39;, params: {
        plant_id: plant1_object.id,
        actual_seed_sewing_date: Date.today,
        plant_start_method: :indirect_sew,
        planting_status: &#39;started_indoors&#39;
      }, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }

      result = JSON.parse(response.body, symbolize_names: true)
      garden_plant = @user.plants.find_by_id(plant1_object.id).garden_plants.first

      expect(response).to be_successful

      expect(garden_plant.id).to eq(result[:data][:id].to_i)

      expect(result).to be_a Hash
      expect(result).to have_key(:data)

      expect(result[:data]).to be_a Hash

      expect(result[:data][:attributes]).to have_key(:recommended_transplant_date)
      expect(result[:data][:attributes]).to have_key(:planting_status)
      expect(result[:data][:attributes][:planting_status]).to eq(&#39;started_indoors&#39;)

      patch &quot;/api/v1/garden_plants/#{garden_plant.id}&quot;, params: { actual_transplant_date: Date.today }, headers: {<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="garden_plants_request_spec.html#L859" class="js-smell-location">0</a>                  <a href="garden_plants_request_spec.html#L897" class="js-smell-location">1</a>                  </div>  </li></ol>
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }

      patch_result = JSON.parse(response.body, symbolize_names: true)

      expect(patch_result[:data][:attributes]).to have_key(:actual_transplant_date)
      expect(patch_result[:data][:attributes][:actual_transplant_date]).to eq(Date.today.to_s)
    end
  end

  describe &#39;DELETE /garden_plants&#39; do
    it &#39;removes the plant from the users list of plants&#39; do
      garden_plant = plant1_object.garden_plants.create!(
        {
          plant_start_method: :indirect_sew,
          planting_status: &#39;not_started&#39;
        }
      )

      delete &quot;/api/v1/garden_plants/#{garden_plant.id}&quot;, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }
      result = JSON.parse(response.body, symbolize_names: true)

      expect(result[:status]).to eq(&#39;success&#39;)
    end
  end
end
</code>
  </div>
</div>

        </div>
      </div>
    </div>

    <!-- JavaScripts -->
    <script src="../../../../assets/vendor/javascripts/jquery.min.js"></script>
    <script src="../../../../assets/vendor/javascripts/jquery.tablesorter.min.js"></script>
    <script src="../../../../assets/vendor/javascripts/jquery.scrollTo.min.js"></script>
    <script src="../../../../assets/vendor/javascripts/jquery.timeago.js"></script>
    <script src="../../../../assets/vendor/javascripts/highcharts.src-4.0.1.js"></script>
    <script src="../../../../assets/vendor/javascripts/prettify.js"></script>
    <script src="../../../../assets/vendor/javascripts/bootstrap.min.js"></script>
    <script src="../../../../assets/javascripts/application.js"></script>
    <script src="../../../../assets/vendor/javascripts/jquery.filtertable.min.js"></script>
  </body>
</html>
