<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Ruby Critic - Home</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- StyleSheets -->
    <link href="../../../../assets/vendor/stylesheets/bootstrap.min.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../../../assets/vendor/stylesheets/font-awesome.min.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../../../assets/vendor/stylesheets/prettify.custom_theme.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../../../assets/stylesheets/application.css" media="screen, projection, print" rel="stylesheet" type="text/css">
  </head>

  <body>
    <header class="navbar navbar-default navbar-fixed-top">
      <a href="#menu-toggle" class="btn btn-default hidden-lg visible-sm-* hidden-md visible-xs-* pull-left" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a>
      <a href="../../../../overview.html"><img src="../../../../assets/images/logo.png" alt="Ruby Critic Logo" title="Ruby Critic Logo" width="55"><span class="logo">RUBYCRITIC</span></a>
      
        <ul class="nav navbar-nav navbar-right">
          <a href="../../../../../main/spec/requests/api/v1/plant_request_spec.html"><span class="branch">main</span></a>
          <a href="../../../../overview.html"><span class="branch">add-rubycritic</span></a>
          <a href="../../../../../overview.html"><span class="branch">Build</span></a>
        </ul>
      
    </header>
    <div id="wrapper">
      <!-- Sidebar -->
      <aside id="sidebar-wrapper">
        <ul class="sidebar-nav">
          <li class="sidebar-item">
            <a href="../../../../overview.html" class="project-nav-item overview-nav"><i class="fa fa-dashboard"></i>Overview</a>
          </li>
          <li class="sidebar-item">
            <a href="../../../../code_index.html" class="project-nav-item code-index-nav"><i class="fa fa-code"></i>Code</a>
          </li>
          <li class="sidebar-item">
            <a href="../../../../smells_index.html" class="project-nav-item smells-index-nav"><i class="fa fa-warning"></i>Smells</a>
          </li>
          <li class="sidebar-item">
            <a href="../../../../simple_cov_index.html" class="project-nav-item coverage-index-nav"><i class="fa fa-umbrella"></i>Coverage</a>
          </li>
        </ul>
      </aside>
      <!-- /#sidebar-wrapper -->
      <div id="page-content-wrapper">
        <div class="container-fluid">
          <div class="row">
  <!--Page Title -->
  <div class="Page_Title">
    <div class="file-time">
      <span class="committed-at">
        
          Updated <time class='js-timeago' datetime='2025-07-08 13:57:23 -0600'>2025-07-08 13:57:23 -0600</time>
        
      </span>
    </div>
    <div>
      <h3><small>spec/requests/api/v1 /</small> plant_request_spec.rb</h3>
    </div>
  </div>
  <!--End Page Title -->
  <div class="Content_Wrapper">
    <!-- code detail -->
    <div class="code-top-detail clearfix row">
      <div class="col-md-8">
        <div class="row">
          <div class="col-md-1">
            <div class="rating f big">
              F
            </div>
          </div>
          <div class="code-statistics col-md-11">
            <div class="col-md-3">
              <div><span class="metric">904</span><small> lines of codes</small></div>
              <div><span class="metric">0</span><small> methods</small></div>
            </div>
            <div class="col-md-3">
              <div><span class="metric">N/A</span><small> complexity/method</small></div>
              <div><span class="metric">39</span><small> churn</small></div>
            </div>
            <div class="col-md-3">
              <div><span class="metric">1787.6</span><small> complexity</small></div>
              <div><span class="metric">636</span><small> duplications</small></div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="code-tabs">
          <ul class="nav nav-pills right-to-left">
            <li><a href="#" id="toggle-code" class="toggle-button button">code</a></li>
            <li class="active">
              <a href="#" id="toggle-smells" class="toggle-button button">
                29
                smells
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <code class="prettyprint linenums lang-ruby file-code js-file-code">require &#39;rails_helper&#39;

RSpec.describe &#39;Plant API Endpoints&#39;, :vcr do
  before(:each) do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>before#each has a flog score of 60</span>          </div>  </li></ol>
    body = {
      name: &#39;Joel Grant&#39;,
      email: &#39;joel@plantcoach.com&#39;,
      zip_code: &#39;80121&#39;,
      password: &#39;12345&#39;,
      password_confirmation: &#39;12345&#39;
    }
    post &#39;/api/v1/users&#39;, params: body

    @user_response = JSON.parse(response.body, symbolize_names: true)
    @user = User.find_by_id(@user_response[:user][:data][:id])

    @user.plant_guides.create(
      plant_type: &#39;Something else&#39;,
      seedling_days_to_transplant: 0,
      direct_seed_recommended: true,
      days_to_maturity: 45,
      days_relative_to_frost_date: 14,
      harvest_period: &#39;one_time&#39;
    )

    @tomato_guide = @user.plant_guides.create(
      plant_type: &#39;Tomato&#39;,
      seedling_days_to_transplant: 49,
      direct_seed_recommended: false,
      days_to_maturity: 55,
      days_relative_to_frost_date: 14,
      harvest_period: &#39;season_long&#39;
    )

    @user.plant_guides.create(
      plant_type: &#39;Pepper&#39;,
      seedling_days_to_transplant: 49,
      direct_seed_recommended: false,
      days_to_maturity: 45,
      days_relative_to_frost_date: 14,
      harvest_period: &#39;season_long&#39;
    )
    @user.plant_guides.create(
      plant_type: &#39;Eggplant&#39;,
      seedling_days_to_transplant: 49,
      direct_seed_recommended: false,
      days_to_maturity: 45,
      days_relative_to_frost_date: 14,
      harvest_period: &#39;season_long&#39;
    )
    @user.plant_guides.create(
      plant_type: &#39;Romaine Lettuce&#39;,
      seedling_days_to_transplant: 0,
      direct_seed_recommended: true,
      days_to_maturity: 45,
      days_relative_to_frost_date: 14,
      harvest_period: &#39;one_time&#39;
    )
    @user.plant_guides.create(
      plant_type: &#39;Green Bean&#39;,
      seedling_days_to_transplant: 0,
      direct_seed_recommended: true,
      days_to_maturity: 45,
      days_relative_to_frost_date: 14,
      harvest_period: &#39;season_long&#39;
    )
    @user.plant_guides.create(
      plant_type: &#39;Radish&#39;,
      seedling_days_to_transplant: 0,
      direct_seed_recommended: true,
      days_to_maturity: 45,
      days_relative_to_frost_date: 14,
      harvest_period: &#39;one_time&#39;
    )
    @user.plant_guides.create(
      plant_type: &#39;Carrot&#39;,
      seedling_days_to_transplant: 0,
      direct_seed_recommended: true,
      days_to_maturity: 60,
      days_relative_to_frost_date: -30,
      harvest_period: &#39;one_week&#39;
    )
    @user.plant_guides.create(
      plant_type: &#39;Sprouting Broccoli&#39;,
      seedling_days_to_transplant: 0,
      direct_seed_recommended: true,
      days_to_maturity: 45,
      days_relative_to_frost_date: -30,
      harvest_period: &#39;four_week&#39;
    )
    @user.plant_guides.create(
      plant_type: &#39;Basil&#39;,
      seedling_days_to_transplant: 0,
      direct_seed_recommended: true,
      days_to_maturity: 30,
      days_relative_to_frost_date: 0,
      harvest_period: &#39;three_week&#39;
    )
    @user.plant_guides.create(
      plant_type: &#39;Cilantro&#39;,
      seedling_days_to_transplant: 0,
      direct_seed_recommended: true,
      days_to_maturity: 30,
      days_relative_to_frost_date: 0,
      harvest_period: &#39;two_week&#39;
    )
    @user.plant_guides.create(
      plant_type: &#39;Raspberry&#39;,
      seedling_days_to_transplant: 0,
      direct_seed_recommended: false,
      days_to_maturity: 100,
      days_relative_to_frost_date: 0,
      harvest_period: &#39;season_long&#39;
    )
  end

  let(:body) do
    {
      name: &#39;Joel Grant&#39;,
      email: &#39;joel@plantcoach.com&#39;,
      zip_code: &#39;80121&#39;,
      password: &#39;12345&#39;,
      password_confirmation: &#39;12345&#39;
    }
  end

  let(:plant1_params) do
    {
      plant_type: &#39;Tomato&#39;,
      name: &#39;Sungold&#39;,
      days_relative_to_frost_date: 14,
      days_to_maturity: 54,
      hybrid_status: :f1
    }
  end
  let(:plant2_params) do
    {
      plant_type: &#39;Pepper&#39;,
      name: &#39;Round of Hungary&#39;,
      days_relative_to_frost_date: 14,
      days_to_maturity: 60,
      hybrid_status: :f1
    }
  end
  let(:plant3_params) do
    {
      plant_type: &#39;Eggplant&#39;,
      name: &#39;Rosa Bianca&#39;,
      days_relative_to_frost_date: 14,
      days_to_maturity: 68,
      hybrid_status: :open_pollinated
    }
  end
  let(:plant4_params) do
    {
      plant_type: &#39;Romaine Lettuce&#39;,
      name: &#39;Costal Star&#39;,
      days_relative_to_frost_date: 30,
      days_to_maturity: 25,
      hybrid_status: :f1
    }
  end
  let(:plant5_params) do
    {
      plant_type: &#39;Green Bean&#39;,
      name: &#39;Provider&#39;,
      days_relative_to_frost_date: -7,
      days_to_maturity: 45,
      hybrid_status: :f1
    }
  end

  let(:user_response) { JSON.parse(response.body, symbolize_names: true) }
  let(:user) { User.find_by_id(user_response[:user][:data][:id]) }

  let(:last_user) { User.last }

  let(:plant1_object) do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 3 nodes</span>              <span>Locations:</span>                  <a href="plant_request_spec.html#L178" class="js-smell-location">0</a>                  <a href="plant_request_spec.html#L187" class="js-smell-location">1</a>                  <a href="plant_request_spec.html#L196" class="js-smell-location">2</a>                  </div>  </li></ol>
    last_user.plants.create!(
      plant_type: &#39;Tomato&#39;,
      name: &#39;Sungold&#39;,
      days_relative_to_frost_date: 14,
      days_to_maturity: 54,
      hybrid_status: :f1
    )
  end
  let(:plant2_object) do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 3 nodes</span>              <span>Locations:</span>                  <a href="plant_request_spec.html#L178" class="js-smell-location">0</a>                  <a href="plant_request_spec.html#L187" class="js-smell-location">1</a>                  <a href="plant_request_spec.html#L196" class="js-smell-location">2</a>                  </div>  </li></ol>
    last_user.plants.create!(
      plant_type: &#39;Pepper&#39;,
      name: &#39;Jalafuego&#39;,
      days_relative_to_frost_date: 14,
      days_to_maturity: 65,
      hybrid_status: :f1
    )
  end
  let(:plant3_object) do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 3 nodes</span>              <span>Locations:</span>                  <a href="plant_request_spec.html#L178" class="js-smell-location">0</a>                  <a href="plant_request_spec.html#L187" class="js-smell-location">1</a>                  <a href="plant_request_spec.html#L196" class="js-smell-location">2</a>                  </div>  </li></ol>
    last_user.plants.create!(
      plant_type: &#39;Radish&#39;,
      name: &#39;French Breakfast&#39;,
      days_relative_to_frost_date: 30,
      days_to_maturity: 21,
      hybrid_status: :f1
    )
  end
  # let(:plant4_object) { last_user.plants.create!(
  #   plant_type: &quot;Tomato&quot;,
  #   name: &quot;Nova&quot;,
  #   days_relative_to_frost_date: 14,
  #   days_to_maturity: 48,
  #   hybrid_status: :f1
  # ) }

  describe &#39;GET /plants&#39; do
    it &#39;retrieves all the plants that have been added to the application by that user&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(GET /plants)::it#retrieves all the plants that have been added to the application by that user has a flog score of 207</span>          </div>  </li></ol>
      # Created to make sure user&#39;s plants don&#39;t show up for other users
      other_user = {
        name: &#39;Bad User&#39;,
        email: &#39;bad@user.com&#39;,
        zip_code: &#39;80121&#39;,
        password: &#39;12345&#39;,
        password_confirmation: &#39;12345&#39;
      }

      post &#39;/api/v1/plants&#39;, params: plant1_params, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }
      post &#39;/api/v1/plants&#39;, params: plant2_params, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }
      post &#39;/api/v1/plants&#39;, params: plant3_params, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }
      post &#39;/api/v1/plants&#39;, params: plant4_params, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }

      post &#39;/api/v1/users&#39;, params: other_user

      expect(response).to be_successful
      second_user_response = JSON.parse(response.body, symbolize_names: true)
      second_user = User.find_by_id(user_response[:user][:data][:id])

      second_user.plant_guides.create(
        plant_type: &#39;Green Bean&#39;,
        seedling_days_to_transplant: 0,
        direct_seed_recommended: true,
        days_to_maturity: 45,
        days_relative_to_frost_date: 14,
        harvest_period: &#39;season_long&#39;
      )

      post &#39;/api/v1/plants&#39;, params: plant5_params, headers: {
        Authorization: &quot;Bearer #{second_user_response[:jwt]}&quot;
      }

      # Sets the cookie to call the first user&#39;s plants instead of the second user&#39;s.
      # cookies[&quot;_session_id&quot;] = cookie_1
      get &#39;/api/v1/plants&#39;, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }

      data = JSON.parse(response.body, symbolize_names: true)

      expect(data).to be_a Hash
      expect(data[:data]).to be_an Array
      expect(data[:data].count).to eq(4)

      data[:data].each do |plant|
        expect(plant).to have_key(:id)
        expect(plant[:id]).to be_a String

        expect(plant).to have_key(:type)
        expect(plant[:type]).to be_a String
        expect(plant[:type]).to eq(&#39;plant&#39;)

        expect(plant[:attributes]).to be_a Hash

        expect(plant[:attributes]).to have_key(:plant_type)
        expect(plant[:attributes][:plant_type]).to be_a String

        expect(plant[:attributes]).to have_key(:name)
        expect(plant[:attributes][:name]).to be_a String

        expect(plant[:attributes]).to have_key(:days_relative_to_frost_date)
        expect(plant[:attributes][:days_relative_to_frost_date]).to be_an Integer

        expect(plant[:attributes]).to have_key(:days_to_maturity)
        expect(plant[:attributes][:days_to_maturity]).to be_an Integer

        expect(plant[:attributes]).to have_key(:hybrid_status)
        expect(plant[:attributes][:hybrid_status]).to eq(&#39;f1&#39;).or eq(&#39;open_pollinated&#39;)
      end
    end
  end

  describe &#39;POST /plants&#39; do
    it &#39;creates a new plant in the database&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(POST /plants)::it#creates a new plant in the database has a flog score of 41</span>          </div>  </li></ol>
      expect(response).to be_successful

      post &#39;/api/v1/plants&#39;, params: plant1_params, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }
      result = JSON.parse(response.body, symbolize_names: true)

      expect(response).to be_successful
      expect(result).to be_a Hash
      expect(result[:data][:attributes][:name]).to eq(&#39;Sungold&#39;)
    end

    it &#39;will create a plant with unknown as the hybrid status if it is not provided&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(POST /plants)::it#will create a plant with unknown as the hybrid status if it is not provided has a flog score of 40</span>          </div>  </li></ol>
      expect(response).to be_successful

      plant_without_hybrid_status = {
        plant_type: &#39;Tomato&#39;,
        name: &#39;Sungold&#39;,
        days_relative_to_frost_date: 14,
        organic: true,
        days_to_maturity: 54
      }

      post &#39;/api/v1/plants&#39;, params: plant_without_hybrid_status, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }

      result = JSON.parse(response.body, symbolize_names: true)

      expect(result).to_not have_key(:error)
      expect(response).to be_successful
      expect(result[:data][:attributes][:hybrid_status]).to eq(&#39;unknown&#39;)
    end

    it &#39;will create a new plant even if the organic status is not known&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(POST /plants)::it#will create a new plant even if the organic status is not known has a flog score of 40</span>          </div>  </li></ol>
      expect(response).to be_successful

      plant_with_missing_organic_field = {
        plant_type: &#39;Tomato&#39;,
        name: &#39;Sungold&#39;,
        days_relative_to_frost_date: 14,
        days_to_maturity: 54,
        hybrid_status: :f1
      }

      post &#39;/api/v1/plants&#39;, params: plant_with_missing_organic_field, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }

      result = JSON.parse(response.body, symbolize_names: true)

      expect(result).to_not have_key(:error)
      expect(response).to be_successful
      expect(result[:data][:attributes][:organic]).to eq(false)
    end

    it &#39;will replace information with default data that the user does not provide&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(POST /plants)::it#will replace information with default data that the user does not provide has a flog score of 65</span>          </div>  </li></ol>
      expect(response).to be_successful

      plant = {
        plant_type: &#39;Tomato&#39;,
        name: &#39;Sungold&#39;
      }
      post &#39;/api/v1/plants&#39;, params: plant, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }
      result = JSON.parse(response.body, symbolize_names: true)

      expect(response.status).to eq(201)
      expect(result).to be_a Hash
      expect(result[:data][:attributes][:name]).to eq(&#39;Sungold&#39;)
      expect(result[:data][:attributes][:days_to_maturity]).to eq(55)
      expect(result[:data][:attributes][:days_relative_to_frost_date]).to eq(14)
    end

    it &#39;only accepts number values for days_to_maturity and day_relative_to_frost_date and returns an informative error message&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(POST /plants)::it#only accepts number values for days_to_maturity and day_relative_to_frost_date and returns an informative error message has a flog score of 51</span>          </div>  </li></ol>
      expect(response).to be_successful

      plant = {
        plant_type: &#39;Tomato&#39;,
        name: &#39;Sungold&#39;,
        days_to_maturity: &#39;ABCD&#39;,
        days_relative_to_frost_date: &#39;ABCD&#39;,
        hybrid_status: :f1
      }
      post &#39;/api/v1/plants&#39;, params: plant, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }
      result = JSON.parse(response.body, symbolize_names: true)

      expect(result[:errors]).to be_an Array
      expect(result[:errors].count).to eq(2)
      expect(result[:errors][0]).to eq(&#39;Days to Maturity must be an integer, greater than 0!&#39;)
      expect(result[:errors][1]).to eq(&#39;Days Relative to Frost Date must be a whole number, and can be postive or negative!&#39;)
    end

    it &#39;will only allow whole integers to be used and will return a specific response message if it receives a fraction or decimal&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(POST /plants)::it#will only allow whole integers to be used and will return a specific response message if it receives a fraction or decimal has a flog score of 52</span>          </div>  </li></ol>
      expect(response).to be_successful

      plant = {
        plant_type: &#39;Tomato&#39;,
        name: &#39;Sungold&#39;,
        days_to_maturity: 0.5,
        days_relative_to_frost_date: 1.2,
        hybrid_status: :f1
      }
      post &#39;/api/v1/plants&#39;, params: plant, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }
      result = JSON.parse(response.body, symbolize_names: true)

      expect(result[:errors]).to be_an Array
      expect(result[:errors].count).to eq(2)
      expect(result[:errors][0]).to eq(&#39;Days to Maturity must be an integer, greater than 0!&#39;)
      expect(result[:errors][1]).to eq(&#39;Days Relative to Frost Date must be a whole number, and can be postive or negative!&#39;)
    end

    it &#39;specifically only accepts positive numbers for the days to maturity field&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(POST /plants)::it#specifically only accepts positive numbers for the days to maturity field has a flog score of 42</span>          </div>  </li></ol>
      expect(response).to be_successful

      plant = {
        plant_type: &#39;Tomato&#39;,
        name: &#39;Sungold&#39;,
        days_to_maturity: -40,
        days_relative_to_frost_date: 5,
        hybrid_status: :f1
      }
      post &#39;/api/v1/plants&#39;, params: plant, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }
      result = JSON.parse(response.body, symbolize_names: true)

      expect(result[:errors]).to be_an Array
      expect(result[:errors].count).to eq(1)
      expect(result[:errors][0]).to eq(&#39;Days to Maturity must be an integer, greater than 0!&#39;)
    end

    it &#39;allows positive and negative values for days relative to frost date&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(POST /plants)::it#allows positive and negative values for days relative to frost date has a flog score of 40</span>          </div>  </li></ol>
      expect(response).to be_successful

      plant = {
        plant_type: &#39;Tomato&#39;,
        name: &#39;Sungold&#39;,
        days_to_maturity: 40,
        days_relative_to_frost_date: -10,
        hybrid_status: :f1
      }
      post &#39;/api/v1/plants&#39;, params: plant, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }
      result = JSON.parse(response.body, symbolize_names: true)

      expect(result[:data][:attributes][:name]).to eq(&#39;Sungold&#39;)
      expect(result[:data][:attributes][:id]).to be_an Integer
    end

    it &#39;will assign a season-long harvest period to a plant such as a tomato&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 7 nodes</span>              <span>Locations:</span>                  <a href="plant_request_spec.html#L454" class="js-smell-location">0</a>                  <a href="plant_request_spec.html#L474" class="js-smell-location">1</a>                  <a href="plant_request_spec.html#L494" class="js-smell-location">2</a>                  <a href="plant_request_spec.html#L514" class="js-smell-location">3</a>                  <a href="plant_request_spec.html#L534" class="js-smell-location">4</a>                  <a href="plant_request_spec.html#L554" class="js-smell-location">5</a>                  <a href="plant_request_spec.html#L574" class="js-smell-location">6</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(POST /plants)::it#will assign a season-long harvest period to a plant such as a tomato has a flog score of 64</span>          </div>  </li></ol>
      expect(response).to be_successful

      plant = {
        plant_type: &#39;Tomato&#39;,
        name: &#39;Sungold&#39;
      }
      post &#39;/api/v1/plants&#39;, params: plant, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }
      result = JSON.parse(response.body, symbolize_names: true)

      expect(response.status).to eq(201)

      expect(result).to be_a Hash
      expect(result[:data][:attributes][:plant_type]).to eq(&#39;Tomato&#39;)
      expect(result[:data][:attributes][:name]).to eq(&#39;Sungold&#39;)
      expect(result[:data][:attributes][:harvest_period]).to eq(&#39;season_long&#39;)
    end

    it &#39;will assign a season-long harvest period to a plant such as an Eggplant&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 7 nodes</span>              <span>Locations:</span>                  <a href="plant_request_spec.html#L454" class="js-smell-location">0</a>                  <a href="plant_request_spec.html#L474" class="js-smell-location">1</a>                  <a href="plant_request_spec.html#L494" class="js-smell-location">2</a>                  <a href="plant_request_spec.html#L514" class="js-smell-location">3</a>                  <a href="plant_request_spec.html#L534" class="js-smell-location">4</a>                  <a href="plant_request_spec.html#L554" class="js-smell-location">5</a>                  <a href="plant_request_spec.html#L574" class="js-smell-location">6</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(POST /plants)::it#will assign a season-long harvest period to a plant such as an Eggplant has a flog score of 64</span>          </div>  </li></ol>
      expect(response).to be_successful

      plant = {
        plant_type: &#39;Eggplant&#39;,
        name: &#39;Rosa Bianca&#39;
      }
      post &#39;/api/v1/plants&#39;, params: plant, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }
      result = JSON.parse(response.body, symbolize_names: true)

      expect(response.status).to eq(201)

      expect(result).to be_a Hash
      expect(result[:data][:attributes][:plant_type]).to eq(&#39;Eggplant&#39;)
      expect(result[:data][:attributes][:name]).to eq(&#39;Rosa Bianca&#39;)
      expect(result[:data][:attributes][:harvest_period]).to eq(&#39;season_long&#39;)
    end

    it &#39;will assign a four-week harvest period to a plant such as sprouting broccoli&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 7 nodes</span>              <span>Locations:</span>                  <a href="plant_request_spec.html#L454" class="js-smell-location">0</a>                  <a href="plant_request_spec.html#L474" class="js-smell-location">1</a>                  <a href="plant_request_spec.html#L494" class="js-smell-location">2</a>                  <a href="plant_request_spec.html#L514" class="js-smell-location">3</a>                  <a href="plant_request_spec.html#L534" class="js-smell-location">4</a>                  <a href="plant_request_spec.html#L554" class="js-smell-location">5</a>                  <a href="plant_request_spec.html#L574" class="js-smell-location">6</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(POST /plants)::it#will assign a four-week harvest period to a plant such as sprouting broccoli has a flog score of 64</span>          </div>  </li></ol>
      expect(response).to be_successful

      plant = {
        plant_type: &#39;Sprouting Broccoli&#39;,
        name: &#39;Di Cicco&#39;
      }
      post &#39;/api/v1/plants&#39;, params: plant, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }
      result = JSON.parse(response.body, symbolize_names: true)

      expect(response.status).to eq(201)

      expect(result).to be_a Hash
      expect(result[:data][:attributes][:plant_type]).to eq(&#39;Sprouting Broccoli&#39;)
      expect(result[:data][:attributes][:name]).to eq(&#39;Di Cicco&#39;)
      expect(result[:data][:attributes][:harvest_period]).to eq(&#39;four_week&#39;)
    end

    it &#39;will assign a three-week harvest period to a plant such as a cucumber&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 7 nodes</span>              <span>Locations:</span>                  <a href="plant_request_spec.html#L454" class="js-smell-location">0</a>                  <a href="plant_request_spec.html#L474" class="js-smell-location">1</a>                  <a href="plant_request_spec.html#L494" class="js-smell-location">2</a>                  <a href="plant_request_spec.html#L514" class="js-smell-location">3</a>                  <a href="plant_request_spec.html#L534" class="js-smell-location">4</a>                  <a href="plant_request_spec.html#L554" class="js-smell-location">5</a>                  <a href="plant_request_spec.html#L574" class="js-smell-location">6</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(POST /plants)::it#will assign a three-week harvest period to a plant such as a cucumber has a flog score of 64</span>          </div>  </li></ol>
      expect(response).to be_successful

      plant = {
        plant_type: &#39;Basil&#39;,
        name: &#39;Thai Towers&#39;
      }
      post &#39;/api/v1/plants&#39;, params: plant, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }
      result = JSON.parse(response.body, symbolize_names: true)

      expect(response.status).to eq(201)

      expect(result).to be_a Hash
      expect(result[:data][:attributes][:plant_type]).to eq(&#39;Basil&#39;)
      expect(result[:data][:attributes][:name]).to eq(&#39;Thai Towers&#39;)
      expect(result[:data][:attributes][:harvest_period]).to eq(&#39;three_week&#39;)
    end

    it &#39;will assign a two-week harvest period to a plant such as cilantro&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 7 nodes</span>              <span>Locations:</span>                  <a href="plant_request_spec.html#L454" class="js-smell-location">0</a>                  <a href="plant_request_spec.html#L474" class="js-smell-location">1</a>                  <a href="plant_request_spec.html#L494" class="js-smell-location">2</a>                  <a href="plant_request_spec.html#L514" class="js-smell-location">3</a>                  <a href="plant_request_spec.html#L534" class="js-smell-location">4</a>                  <a href="plant_request_spec.html#L554" class="js-smell-location">5</a>                  <a href="plant_request_spec.html#L574" class="js-smell-location">6</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(POST /plants)::it#will assign a two-week harvest period to a plant such as cilantro has a flog score of 64</span>          </div>  </li></ol>
      expect(response).to be_successful

      plant = {
        plant_type: &#39;Cilantro&#39;,
        name: &#39;CantThinkOfAName&#39;
      }
      post &#39;/api/v1/plants&#39;, params: plant, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }
      result = JSON.parse(response.body, symbolize_names: true)

      expect(response.status).to eq(201)

      expect(result).to be_a Hash
      expect(result[:data][:attributes][:plant_type]).to eq(&#39;Cilantro&#39;)
      expect(result[:data][:attributes][:name]).to eq(&#39;CantThinkOfAName&#39;)
      expect(result[:data][:attributes][:harvest_period]).to eq(&#39;two_week&#39;)
    end

    it &#39;will assign a one-week harvest period to a plant such as a carrot&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 7 nodes</span>              <span>Locations:</span>                  <a href="plant_request_spec.html#L454" class="js-smell-location">0</a>                  <a href="plant_request_spec.html#L474" class="js-smell-location">1</a>                  <a href="plant_request_spec.html#L494" class="js-smell-location">2</a>                  <a href="plant_request_spec.html#L514" class="js-smell-location">3</a>                  <a href="plant_request_spec.html#L534" class="js-smell-location">4</a>                  <a href="plant_request_spec.html#L554" class="js-smell-location">5</a>                  <a href="plant_request_spec.html#L574" class="js-smell-location">6</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(POST /plants)::it#will assign a one-week harvest period to a plant such as a carrot has a flog score of 64</span>          </div>  </li></ol>
      expect(response).to be_successful

      plant = {
        plant_type: &#39;Carrot&#39;,
        name: &#39;Sugarsnax&#39;
      }
      post &#39;/api/v1/plants&#39;, params: plant, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }
      result = JSON.parse(response.body, symbolize_names: true)

      expect(response.status).to eq(201)

      expect(result).to be_a Hash
      expect(result[:data][:attributes][:plant_type]).to eq(&#39;Carrot&#39;)
      expect(result[:data][:attributes][:name]).to eq(&#39;Sugarsnax&#39;)
      expect(result[:data][:attributes][:harvest_period]).to eq(&#39;one_week&#39;)
    end

    it &#39;will assign a one-time harvest period to a plant such as a head of lettuce&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 7 nodes</span>              <span>Locations:</span>                  <a href="plant_request_spec.html#L454" class="js-smell-location">0</a>                  <a href="plant_request_spec.html#L474" class="js-smell-location">1</a>                  <a href="plant_request_spec.html#L494" class="js-smell-location">2</a>                  <a href="plant_request_spec.html#L514" class="js-smell-location">3</a>                  <a href="plant_request_spec.html#L534" class="js-smell-location">4</a>                  <a href="plant_request_spec.html#L554" class="js-smell-location">5</a>                  <a href="plant_request_spec.html#L574" class="js-smell-location">6</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(POST /plants)::it#will assign a one-time harvest period to a plant such as a head of lettuce has a flog score of 64</span>          </div>  </li></ol>
      expect(response).to be_successful

      plant = {
        plant_type: &#39;Romaine Lettuce&#39;,
        name: &#39;Coastal Star&#39;
      }
      post &#39;/api/v1/plants&#39;, params: plant, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }
      result = JSON.parse(response.body, symbolize_names: true)

      expect(response.status).to eq(201)

      expect(result).to be_a Hash
      expect(result[:data][:attributes][:plant_type]).to eq(&#39;Romaine Lettuce&#39;)
      expect(result[:data][:attributes][:name]).to eq(&#39;Coastal Star&#39;)
      expect(result[:data][:attributes][:harvest_period]).to eq(&#39;one_time&#39;)
    end

    # This scenario should never happen.
    it &#39;will return an error message if the plant could not be created due to missing information&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(POST /plants)::it#will return an error message if the plant could not be created due to missing information has a flog score of 47</span>          </div>  </li></ol>
      ActiveRecord::Base.skip_callbacks = true

      expect(response).to be_successful

      plant = {
        name: &#39;Sungold&#39;
      }

      post &#39;/api/v1/plants&#39;, params: plant, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }
      result = JSON.parse(response.body, symbolize_names: true)

      expect(result).to have_key(:errors)

      expect(result[:errors]).to include(&quot;&#39;Plant Type&#39; can not be blank!&quot;)
      expect(result[:errors]).to include(&quot;&#39;Days to Maturity&#39; can not be blank!&quot;)
      expect(result[:errors]).to include(&quot;&#39;Days to Maturity&#39; can not be blank!&quot;)
    end

    context &#39;creating two plants with the same name&#39; do
      context &#39;with the same user&#39; do
        context &#39;with different plant types&#39;
        it &#39;is successful&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(POST /plants)::context(creating two plants with the same name)::context(with the same user)::it#is successful has a flog score of 170</span>          </div>  </li></ol>
          nova_tomato_params = {
            plant_type: &#39;Tomato&#39;,
            name: &#39;Nova&#39;,
            days_relative_to_frost_date: 14,
            days_to_maturity: 48,
            hybrid_status: :f1
          }

          post &#39;/api/v1/plants&#39;, params: nova_tomato_params, headers: {
            Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
          }
          JSON.parse(response.body, symbolize_names: true)

          nova_raspberry_params = {
            plant_type: &#39;Raspberry&#39;,
            name: &#39;Nova&#39;,
            days_relative_to_frost_date: 0,
            days_to_maturity: 100,
            hybrid_status: :f1
          }

          post &#39;/api/v1/plants&#39;, params: nova_raspberry_params, headers: {
            Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
          }

          result = JSON.parse(response.body, symbolize_names: true)

          expect(response).to be_successful

          expect(result[:data][:id]).to_not be nil
          expect(result[:data][:attributes][:name]).to eq(nova_raspberry_params[:name])
          expect(result[:data][:attributes][:plant_type]).to eq(nova_raspberry_params[:plant_type])

          get &#39;/api/v1/plants&#39;, headers: {
            Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
          }

          users_plants_result = JSON.parse(response.body, symbolize_names: true)

          expect(users_plants_result[:data][0][:attributes][:id]).to be_an Integer
          expect(users_plants_result[:data][0][:attributes][:name]).to eq(&#39;Nova&#39;)
          expect(users_plants_result[:data][0][:attributes][:plant_type]).to eq(&#39;Tomato&#39;)

          expect(users_plants_result[:data][1][:attributes][:id]).to be_an Integer
          expect(users_plants_result[:data][1][:attributes][:name]).to eq(&#39;Nova&#39;)
          expect(users_plants_result[:data][1][:attributes][:plant_type]).to eq(&#39;Raspberry&#39;)
        end

        context &#39;with the same plant types&#39; do
          it &#39;is unsuccessful&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(POST /plants)::context(creating two plants with the same name)::context(with the same user)::context(with the same plant types)::it#is unsuccessful has a flog score of 30</span>          </div>  </li></ol>
            nova_tomato_params = {
              plant_type: &#39;Tomato&#39;,
              name: &#39;Nova&#39;,
              days_relative_to_frost_date: 14,
              days_to_maturity: 48,
              hybrid_status: :f1
            }

            post &#39;/api/v1/plants&#39;, params: nova_tomato_params, headers: {
              Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
            }
            JSON.parse(response.body, symbolize_names: true)

            # Try to create the same plant a second time
            post &#39;/api/v1/plants&#39;, params: nova_tomato_params, headers: {
              Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
            }

            JSON.parse(response.body, symbolize_names: true)

            expect(response).to be_forbidden
          end

          it &#39;returns an informative response&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(POST /plants)::context(creating two plants with the same name)::context(with the same user)::context(with the same plant types)::it#returns an informative response has a flog score of 47</span>          </div>  </li></ol>
            nova_tomato_params = {
              plant_type: &#39;Tomato&#39;,
              name: &#39;Nova&#39;,
              days_relative_to_frost_date: 14,
              days_to_maturity: 48,
              hybrid_status: :f1
            }

            post &#39;/api/v1/plants&#39;, params: nova_tomato_params, headers: {
              Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
            }
            JSON.parse(response.body, symbolize_names: true)

            # Try to create the same plant a second time
            post &#39;/api/v1/plants&#39;, params: nova_tomato_params, headers: {
              Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
            }

            result = JSON.parse(response.body, symbolize_names: true)

            expect(response).to be_forbidden

            expect(result[:errors][0]).to eq(&quot;A #{nova_tomato_params[:plant_type]} plant named #{nova_tomato_params[:name]} already exists for #{@user.name}!&quot;)
          end
        end
      end

      context &#39;with different users&#39; do
        context &#39;with the same plant types&#39; do
          it &#39;is successful&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(POST /plants)::context(creating two plants with the same name)::context(with different users)::context(with the same plant types)::it#is successful has a flog score of 143</span>          </div>  </li></ol>
            nova_tomato_params = {
              plant_type: &#39;Tomato&#39;,
              name: &#39;Nova&#39;,
              days_relative_to_frost_date: 14,
              days_to_maturity: 48,
              hybrid_status: :f1
            }

            post &#39;/api/v1/plants&#39;, params: nova_tomato_params, headers: {
              Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
            }

            expect(response).to be_successful

            JSON.parse(response.body, symbolize_names: true)

            # Introduce a 2nd user and same plant.
            user2_params = {
              name: &#39;Joel Grant2&#39;,
              email: &#39;joel2@plantcoach.com&#39;,
              zip_code: &#39;80121&#39;,
              password: &#39;12345&#39;,
              password_confirmation: &#39;12345&#39;
            }
            post &#39;/api/v1/users&#39;, params: user2_params

            user2_response = JSON.parse(response.body, symbolize_names: true)
            user2 = User.find_by_id(user_response[:user][:data][:id])

            user2.plant_guides.create!(<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="plant_request_spec.html#L753" class="js-smell-location">0</a>                  <a href="plant_request_spec.html#L786" class="js-smell-location">1</a>                  </div>  </li></ol>
              plant_type: &#39;Tomato&#39;,
              seedling_days_to_transplant: 49,
              direct_seed_recommended: false,
              days_to_maturity: 55,
              days_relative_to_frost_date: 14,
              harvest_period: &#39;season_long&#39;
            )

            post &#39;/api/v1/plants&#39;, params: nova_tomato_params, headers: {
              Authorization: &quot;Bearer #{user2_response[:jwt]}&quot;
            }

            result2 = JSON.parse(response.body, symbolize_names: true)

            expect(response).to be_successful

            expect(result2[:data][:attributes][:user_id]).to eq(user2.id)
            expect(result2[:data][:attributes][:id]).to_not be nil

            # Introduce a 3rd user and same plant.
            user3_params = {
              name: &#39;Joel Grant3&#39;,
              email: &#39;joel3@plantcoach.com&#39;,
              zip_code: &#39;80121&#39;,
              password: &#39;12345&#39;,
              password_confirmation: &#39;12345&#39;
            }
            post &#39;/api/v1/users&#39;, params: user3_params

            user3_response = JSON.parse(response.body, symbolize_names: true)
            user3 = User.find_by_id(user3_response[:user][:data][:id])

            user3.plant_guides.create!(<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="plant_request_spec.html#L753" class="js-smell-location">0</a>                  <a href="plant_request_spec.html#L786" class="js-smell-location">1</a>                  </div>  </li></ol>
              plant_type: &#39;Tomato&#39;,
              seedling_days_to_transplant: 49,
              direct_seed_recommended: false,
              days_to_maturity: 55,
              days_relative_to_frost_date: 14,
              harvest_period: &#39;season_long&#39;
            )

            post &#39;/api/v1/plants&#39;, params: nova_tomato_params, headers: {
              Authorization: &quot;Bearer #{user3_response[:jwt]}&quot;
            }

            expect(response).to be_successful

            result3 = JSON.parse(response.body, symbolize_names: true)

            expect(result3[:data][:attributes][:user_id]).to eq(user3.id)
            expect(result3[:data][:attributes][:id]).to_not be nil
          end
        end
      end
    end
  end

  describe &#39;GET /plants/plant_id&#39; do
    it &#39;returns the unique plant record that belongs to the user&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(GET /plants/plant_id)::it#returns the unique plant record that belongs to the user has a flog score of 71</span>          </div>  </li></ol>
      ActiveRecord::Base.skip_callbacks = false
      expect(response).to be_successful

      plant = {
        plant_type: &#39;Tomato&#39;,
        name: &#39;Sakura&#39;
      }
      post &#39;/api/v1/plants&#39;, params: plant, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }

      expect(response).to be_successful

      plant_result = JSON.parse(response.body, symbolize_names: true)
      plant_id = plant_result[:data][:attributes][:id]

      get &quot;/api/v1/plants/#{plant_id}&quot;, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }

      result = JSON.parse(response.body, symbolize_names: true)

      expect(result[:data][:attributes][:name]).to eq(&#39;Sakura&#39;)
      expect(result[:data][:attributes][:plant_type]).to eq(&#39;Tomato&#39;)
      expect(result[:data][:attributes][:id]).to eq(plant_id)
    end

    it &#39;returns an error response when the ID is wrong&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(GET /plants/plant_id)::it#returns an error response when the ID is wrong has a flog score of 39</span>          </div>  </li></ol>
      ActiveRecord::Base.skip_callbacks = false
      expect(response).to be_successful

      plant = {
        plant_type: &#39;Tomato&#39;,
        name: &#39;Sakura&#39;
      }
      post &#39;/api/v1/plants&#39;, params: plant, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }

      expect(response).to be_successful

      JSON.parse(response.body, symbolize_names: true)
      non_existent_id = 203_948

      get &quot;/api/v1/plants/#{non_existent_id}&quot;, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }

      result = JSON.parse(response.body, symbolize_names: true)

      expect(result[:error]).to eq(&#39;The plant can not be found!&#39;)
    end
  end

  describe &#39;PATCH /plants&#39; do
    it &#39;updates an existing plant with new attributes&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(PATCH /plants)::it#updates an existing plant with new attributes has a flog score of 30</span>          </div>  </li></ol>
      expect(response).to be_successful

      patch &quot;/api/v1/plants/#{plant1_object.id}&quot;, params: { days_to_maturity: 61 }, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }

      result = JSON.parse(response.body, symbolize_names: true)

      expect(result[:data][:attributes][:days_to_maturity]).to eq(61)
    end
  end

  describe &#39;DELETE /plants&#39; do
    it &#39;removes a plant from the list of available plants&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(DELETE /plants)::it#removes a plant from the list of available plants has a flog score of 31</span>          </div>  </li></ol>
      expect(response).to be_successful

      delete &quot;/api/v1/plants/#{plant3_object.id}&quot;, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }
      JSON.parse(response.body, symbolize_names: true)

      expect(Plant.find_by(id: plant3_object.id)).to be nil
    end

    it &#39;returns an error if the plant can not be found&#39; do
      expect(response).to be_successful

      delete &#39;/api/v1/plants/999999&#39;, headers: {
        Authorization: &quot;Bearer #{@user_response[:jwt]}&quot;
      }

      result = JSON.parse(response.body, symbolize_names: true)
      expect(result[:error]).to eq(&#39;Something happened!&#39;)
    end
  end
end
</code>
  </div>
</div>

        </div>
      </div>
    </div>

    <!-- JavaScripts -->
    <script src="../../../../assets/vendor/javascripts/jquery.min.js"></script>
    <script src="../../../../assets/vendor/javascripts/jquery.tablesorter.min.js"></script>
    <script src="../../../../assets/vendor/javascripts/jquery.scrollTo.min.js"></script>
    <script src="../../../../assets/vendor/javascripts/jquery.timeago.js"></script>
    <script src="../../../../assets/vendor/javascripts/highcharts.src-4.0.1.js"></script>
    <script src="../../../../assets/vendor/javascripts/prettify.js"></script>
    <script src="../../../../assets/vendor/javascripts/bootstrap.min.js"></script>
    <script src="../../../../assets/javascripts/application.js"></script>
    <script src="../../../../assets/vendor/javascripts/jquery.filtertable.min.js"></script>
  </body>
</html>
